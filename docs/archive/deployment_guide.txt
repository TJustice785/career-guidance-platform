# Complete Deployment Guide

## Table of Contents
1. [Firebase Setup](#firebase-setup)
2. [Backend Deployment](#backend-deployment)
3. [Frontend Deployment](#frontend-deployment)
4. [Environment Variables](#environment-variables)
5. [Testing](#testing)

---

## 1. Firebase Setup

### Step 1: Create Firebase Project

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Click "Add project"
3. Enter project name: `career-guidance-platform`
4. Disable Google Analytics (optional)
5. Click "Create project"

### Step 2: Enable Authentication

1. In Firebase Console, go to **Build** > **Authentication**
2. Click "Get started"
3. Click on **Sign-in method** tab
4. Enable **Email/Password** provider
5. Click "Save"

### Step 3: Create Firestore Database

1. Go to **Build** > **Firestore Database**
2. Click "Create database"
3. Select "Start in **production mode**"
4. Choose location closest to you (e.g., `europe-west`)
5. Click "Enable"

### Step 4: Configure Firestore Rules

Click on the **Rules** tab and paste:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }
    
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    function isAdmin() {
      return isAuthenticated() && 
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    function isInstitute() {
      return isAuthenticated() && 
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'institute';
    }
    
    function isCompany() {
      return isAuthenticated() && 
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'company';
    }
    
    // Users collection
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update: if isOwner(userId) || isAdmin();
      allow delete: if isAdmin();
    }
    
    // Institutions, faculties, courses
    match /institutions/{document=**} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /faculties/{document=**} {
      allow read: if true;
      allow write: if isAdmin() || isInstitute();
    }
    
    match /courses/{document=**} {
      allow read: if true;
      allow write: if isAdmin() || isInstitute();
    }
    
    // Applications
    match /applications/{applicationId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update: if isAdmin() || isInstitute() || isOwner(resource.data.studentId);
      allow delete: if isAdmin();
    }
    
    // Admissions
    match /admissions/{admissionId} {
      allow read: if isAuthenticated();
      allow create: if isAdmin() || isInstitute();
      allow update: if isAuthenticated();
      allow delete: if isAdmin();
    }
    
    // Jobs
    match /jobs/{jobId} {
      allow read: if isAuthenticated();
      allow create: if isCompany();
      allow update: if isCompany() && isOwner(resource.data.companyId);
      allow delete: if isCompany() && isOwner(resource.data.companyId) || isAdmin();
    }
    
    // Job applications
    match /jobApplications/{applicationId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update: if isCompany() || isOwner(resource.data.studentId);
      allow delete: if isAdmin();
    }
    
    // Documents
    match /documents/{documentId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
      allow update: if isOwner(resource.data.userId);
      allow delete: if isOwner(resource.data.userId) || isAdmin();
    }
    
    // Notifications
    match /notifications/{notificationId} {
      allow read: if isAuthenticated() && isOwner(resource.data.userId);
      allow create: if isAuthenticated();
      allow update: if isOwner(resource.data.userId);
      allow delete: if isOwner(resource.data.userId) || isAdmin();
    }
  }
}
```

Click "Publish"

### Step 5: Enable Storage

1. Go to **Build** > **Storage**
2. Click "Get started"
3. Click "Next" (keep default rules for now)
4. Choose same location as Firestore
5. Click "Done"

### Step 6: Configure Storage Rules

Click on **Rules** tab and paste:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /documents/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /transcripts/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /certificates/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

Click "Publish"

### Step 7: Get Firebase Config

1. Go to **Project settings** (gear icon)
2. Scroll to "Your apps"
3. Click on the **Web** icon (`</>`)
4. Register app with nickname: `career-guidance-web`
5. Copy the `firebaseConfig` object - you'll need this for frontend `.env`

### Step 8: Generate Service Account Key

1. Go to **Project settings** > **Service accounts**
2. Click "Generate new private key"
3. Click "Generate key"
4. Save the JSON file securely
5. Extract these values for backend `.env`:
   - `project_id` ‚Üí FIREBASE_PROJECT_ID
   - `private_key` ‚Üí FIREBASE_PRIVATE_KEY
   - `client_email` ‚Üí FIREBASE_CLIENT_EMAIL

---

## 2. Backend Deployment

### Option A: Deploy to Railway (Recommended)

#### Step 1: Prepare Repository

```bash
# Initialize git if not already done
git init
git add .
git commit -m "Initial commit"

# Create GitHub repository and push
git remote add origin <your-github-repo-url>
git push -u origin main
```

#### Step 2: Deploy on Railway

1. Go to [Railway.app](https://railway.app/)
2. Sign up/Login with GitHub
3. Click "New Project" > "Deploy from GitHub repo"
4. Select your repository
5. Railway will auto-detect Node.js and deploy

#### Step 3: Add Environment Variables

1. Click on your deployment
2. Go to **Variables** tab
3. Add these variables:

```
PORT=5000
NODE_ENV=production

FIREBASE_PROJECT_ID=your-project-id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...your key...\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project.iam.gserviceaccount.com

EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password

CLIENT_URL=https://your-frontend-url.vercel.app
```

**Important:** For `FIREBASE_PRIVATE_KEY`, make sure to keep the `\n` characters and wrap in quotes.

#### Step 4: Configure Root Directory

1. In Railway, go to **Settings**
2. Set **Root Directory** to `server`
3. Set **Start Command** to `npm start`
4. Click "Deploy"

#### Step 5: Get Backend URL

After deployment, copy your Railway app URL (e.g., `https://your-app.railway.app`)

### Option B: Deploy to Render

1. Go to [Render.com](https://render.com/)
2. Sign up/Login
3. Click "New +" > "Web Service"
4. Connect your GitHub repository
5. Configure:
   - **Name:** career-guidance-api
   - **Root Directory:** server
   - **Environment:** Node
   - **Build Command:** `npm install`
   - **Start Command:** `npm start`
6. Add environment variables (same as Railway)
7. Click "Create Web Service"

---

## 3. Frontend Deployment

### Option A: Deploy to Vercel (Recommended)

#### Step 1: Install Vercel CLI

```bash
npm install -g vercel
```

#### Step 2: Configure Frontend

1. Update `client/.env`:

```env
REACT_APP_API_URL=https://your-backend-url.railway.app/api
REACT_APP_FIREBASE_API_KEY=your-api-key
REACT_APP_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your-project-id
REACT_APP_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=your-sender-id
REACT_APP_FIREBASE_APP_ID=your-app-id
```

#### Step 3: Deploy

```bash
cd client
vercel login
vercel

# Follow prompts:
# - Set up and deploy? Yes
# - Which scope? Your account
# - Link to existing project? No
# - Project name? career-guidance-client
# - Directory? ./
# - Override settings? No

# For production deployment:
vercel --prod
```

#### Step 4: Add Environment Variables in Vercel

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Select your project
3. Go to **Settings** > **Environment Variables**
4. Add all variables from `.env`
5. Redeploy: `vercel --prod`

### Option B: Deploy to Firebase Hosting

#### Step 1: Install Firebase CLI

```bash
npm install -g firebase-tools
firebase login
```

#### Step 2: Initialize Firebase Hosting

```bash
cd client
firebase init hosting

# Select:
# - Use existing project
# - Select your Firebase project
# - Public directory: build
# - Single-page app: Yes
# - Automatic builds with GitHub: No
```

#### Step 3: Build and Deploy

```bash
npm run build
firebase deploy --only hosting
```

Your app will be live at `https://your-project.firebaseapp.com`

### Option C: Deploy to Netlify

1. Go to [Netlify](https://netlify.com)
2. Click "Add new site" > "Import an existing project"
3. Connect GitHub repository
4. Configure:
   - **Base directory:** client
   - **Build command:** `npm run build`
   - **Publish directory:** `client/build`
5. Add environment variables in **Site settings** > **Environment variables**
6. Click "Deploy"

---

## 4. Environment Variables Reference

### Backend (.env)

```env
# Server Configuration
PORT=5000
NODE_ENV=production

# Firebase Admin SDK
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project.iam.gserviceaccount.com

# Email Configuration (Gmail)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-16-char-app-password

# Frontend URL (for CORS)
CLIENT_URL=https://your-frontend.vercel.app
```

### Frontend (.env)

```env
# Backend API
REACT_APP_API_URL=https://your-backend.railway.app/api

# Firebase Client Configuration
REACT_APP_FIREBASE_API_KEY=AIzaSyXxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
REACT_APP_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=your-project-id
REACT_APP_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=123456789012
REACT_APP_FIREBASE_APP_ID=1:123456789012:web:abcdef123456
```

### Getting Gmail App Password

1. Go to your Google Account: https://myaccount.google.com/
2. Click **Security** > **2-Step Verification** (enable if not already)
3. Scroll to **App passwords**
4. Click **Select app** > **Other (Custom name)**
5. Enter "Career Guidance Platform"
6. Click **Generate**
7. Copy the 16-character password
8. Use this as `EMAIL_PASSWORD`

---

## 5. Initial Admin Setup

### Create Admin User Manually

After deployment, you need to create the first admin user:

#### Option 1: Using Firebase Console

1. Go to Firebase Console > **Authentication**
2. Click **Add user**
3. Email: `admin@careerpath.ls`
4. Password: `Admin@123456`
5. Click **Add user**
6. Copy the User UID

Then go to **Firestore Database** > **users** collection:

1. Click **Add document**
2. Document ID: `<paste-the-uid>`
3. Add fields:
   ```
   email: "admin@careerpath.ls"
   role: "admin"
   emailVerified: true
   createdAt: <timestamp>
   firstName: "System"
   lastName: "Administrator"
   ```
4. Click **Save**

#### Option 2: Using Code Script

Create `server/scripts/createAdmin.js`:

```javascript
const admin = require('firebase-admin');
require('dotenv').config();

const serviceAccount = {
  type: "service_account",
  project_id: process.env.FIREBASE_PROJECT_ID,
  private_key: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
  client_email: process.env.FIREBASE_CLIENT_EMAIL,
};

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const auth = admin.auth();
const db = admin.firestore();

async function createAdmin() {
  try {
    // Create user in Firebase Auth
    const userRecord = await auth.createUser({
      email: 'admin@careerpath.ls',
      password: 'Admin@123456',
      emailVerified: true
    });

    console.log('Admin user created:', userRecord.uid);

    // Create user document in Firestore
    await db.collection('users').doc(userRecord.uid).set({
      email: 'admin@careerpath.ls',
      role: 'admin',
      emailVerified: true,
      firstName: 'System',
      lastName: 'Administrator',
      createdAt: admin.firestore.Timestamp.now(),
      updatedAt: admin.firestore.Timestamp.now()
    });

    console.log('Admin user document created successfully!');
    console.log('Email: admin@careerpath.ls');
    console.log('Password: Admin@123456');
    console.log('\n‚ö†Ô∏è  IMPORTANT: Change this password immediately after first login!');
    
    process.exit(0);
  } catch (error) {
    console.error('Error creating admin:', error);
    process.exit(1);
  }
}

createAdmin();
```

Run it:

```bash
cd server
node scripts/createAdmin.js
```

---

## 6. Testing Deployment

### Backend Health Check

```bash
curl https://your-backend-url.railway.app/health
```

Expected response:
```json
{
  "status": "success",
  "message": "Server is running",
  "timestamp": "2025-10-21T10:30:00.000Z"
}
```

### Frontend Test

1. Visit your frontend URL
2. Click "Get Started" or "Register"
3. Try creating a student account
4. Check your email for verification link
5. Login with the account

### Full Flow Test

1. **As Admin:**
   - Login with admin credentials
   - Add an institution
   - Add faculties and courses

2. **As Student:**
   - Register and verify email
   - Browse institutions
   - Apply for courses
   - Check application status

3. **As Institute:**
   - Register and verify email
   - Add courses
   - View applications
   - Process applications

4. **As Company:**
   - Register and verify email
   - Wait for admin approval
   - Post a job
   - View applications

---

## 7. Common Issues & Solutions

### Issue 1: CORS Errors

**Solution:** Make sure `CLIENT_URL` in backend `.env` matches your frontend URL exactly.

```env
# Backend .env
CLIENT_URL=https://your-app.vercel.app
```

### Issue 2: Firebase Private Key Error

**Solution:** Ensure the private key includes `\n` characters and is wrapped in quotes:

```env
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nMIIE...\n-----END PRIVATE KEY-----\n"
```

### Issue 3: Email Not Sending

**Solutions:**
1. Use Gmail App Password (not regular password)
2. Enable "Less secure app access" (not recommended)
3. Use a different SMTP provider (SendGrid, Mailgun)

### Issue 4: File Upload Fails

**Solution:** Check Firebase Storage rules and ensure bucket is configured correctly.

### Issue 5: Build Fails on Vercel

**Solution:** Make sure all environment variables are set in Vercel dashboard before deploying.

---

## 8. Monitoring & Maintenance

### Monitor Backend

Railway provides:
- Real-time logs
- Metrics dashboard
- Deployment history

### Monitor Frontend

Vercel provides:
- Analytics
- Error tracking
- Performance metrics

### Firebase Monitoring

1. Go to Firebase Console
2. Check **Authentication** for user activity
3. Check **Firestore Database** for data
4. Check **Storage** for uploaded files
5. Monitor **Usage** tab for quotas

---

## 9. GitHub Repository Setup

### Create .github/workflows/deploy.yml (Optional CI/CD)

```yaml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to Railway
        run: echo "Backend auto-deploys via Railway"

  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to Vercel
        run: echo "Frontend auto-deploys via Vercel"
```

---

## 10. Security Checklist

- [ ] Change default admin password after first login
- [ ] Never commit `.env` files to Git
- [ ] Use strong passwords for all accounts
- [ ] Enable 2FA on Firebase, GitHub, Railway, and Vercel
- [ ] Review Firestore and Storage security rules
- [ ] Set up rate limiting in production
- [ ] Use HTTPS for all connections
- [ ] Regularly update dependencies
- [ ] Monitor Firebase usage and quotas
- [ ] Set up error logging and monitoring

---

## 11. Project Submission

For your assignment submission:

1. **GitHub Repository:**
   - Push all code to public GitHub repository
   - Include README.md
   - Add .gitignore to exclude sensitive files

2. **Live URLs:**
   - Backend API URL
   - Frontend application URL

3. **Documentation:**
   - Include this deployment guide
   - Add API documentation
   - Include user manual

4. **Demo Credentials:**
   ```
   Admin:
   Email: admin@careerpath.ls
   Password: Admin@123456
   
   Test Student:
   Email: student@test.com
   Password: Test@123456
   
   Test Institute:
   Email: institute@test.com
   Password: Test@123456
   
   Test Company:
   Email: company@test.com
   Password: Test@123456
   ```

5. **Video Demo (Optional but Recommended):**
   - Record a 5-10 minute walkthrough
   - Show all major features
   - Demonstrate different user roles

---

## Support & Resources

- **Firebase Documentation:** https://firebase.google.com/docs
- **Railway Documentation:** https://docs.railway.app
- **Vercel Documentation:** https://vercel.com/docs
- **React Documentation:** https://react.dev
- **Node.js Documentation:** https://nodejs.org/docs

---

**Congratulations! Your Career Guidance Platform is now live! üéâ**